<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juvenile Justice Procedures Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .correct {
            background-color: #d1fae5; /* green-100 */
            border-color: #10b981; /* green-500 */
        }
        .incorrect {
            background-color: #fee2e2; /* red-100 */
            border-color: #ef4444; /* red-500 */
        }
        .explanation {
            background-color: #f3f4f6; /* gray-100 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="quiz-container" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white p-8 rounded-2xl shadow-lg">
            <h1 class="text-3xl font-bold text-center text-gray-900 mb-2">Juvenile Justice Procedures Quiz</h1>
            <p class="text-center text-gray-500 mb-8">Practice Version: Review answers as you go.</p>

            <div id="start-screen">
                <p class="text-lg mb-6 text-center">This ultimate final practice quiz now contains 77 questions covering every detail from your handout. After each answer, you'll see a detailed explanation with references. Click "Start Practice" to begin.</p>
                <button id="start-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 text-lg">Start Practice</button>
            </div>

            <div id="quiz-screen" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <div id="question-counter" class="text-sm font-semibold text-gray-600"></div>
                    <div id="score-counter" class="text-sm font-semibold text-gray-600">Score: 0 / 0</div>
                </div>
                <div id="question-card" class="mb-6 p-6 bg-gray-50 rounded-xl border border-gray-200">
                    <h2 id="question-text" class="text-xl font-semibold mb-5"></h2>
                    <div id="options-container" class="space-y-3"></div>
                </div>
                <button id="next-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 disabled:bg-gray-400" disabled>Next Question</button>
            </div>

            <div id="result-screen" class="hidden text-center">
                <h2 class="text-2xl font-bold mb-4">Practice Complete!</h2>
                <p class="text-5xl font-bold mb-4" id="final-score"></p>
                <p class="text-lg text-gray-600 mb-8" id="score-message"></p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="restart-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Restart Practice</button>
                    <button id="review-btn" class="w-full sm:w-auto bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors duration-300">Review All Answers</button>
                </div>
            </div>
        </div>

        <div id="review-section" class="hidden mt-8">
             <h2 class="text-2xl font-bold text-center mb-6">Answer Review</h2>
             <div id="review-container" class="space-y-6"></div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        
        const questionCounter = document.getElementById('question-counter');
        const scoreCounter = document.getElementById('score-counter');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        const finalScore = document.getElementById('final-score');
        const scoreMessage = document.getElementById('score-message');
        
        const reviewSection = document.getElementById('review-section');
        const reviewContainer = document.getElementById('review-container');

        // --- Quiz Data with References ---
        const quizData = [
            // ...existing questions...
                        // --- New questions generated from Juvenile-Procedure.txt ---
                        {
                            question: "What is the primary purpose of Title III, Juvenile Justice Code?",
                            options: [
                                "To punish juveniles as adults",
                                "To provide for the care, protection, and wholesome development of children",
                                "To prioritize the rights of victims over juveniles",
                                "To ensure all juvenile cases are handled in criminal court"
                            ],
                            answer: "To provide for the care, protection, and wholesome development of children",
                            explanation: "Texas Family Code 51.01 sets out the purposes of the juvenile justice system: to protect the public and children, provide treatment and rehabilitation, and ensure fair judicial procedures. The focus is on care, protection, and development, not just punishment. <br><a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.01' target='_blank' class='text-indigo-600 hover:underline'>Read FC 51.01</a>",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.01' target='_blank' class='text-indigo-600 hover:underline'>FC 51.01</a>"
                        },
                        {
                            question: "According to the Family Code, who is considered a 'child'?",
                            options: [
                                "A person under 10 years old",
                                "A person 10 years of age or older and under 17, or 17+ and under 18 with qualifying conduct",
                                "A person 18 or older",
                                "Any person under 21"
                            ],
                            answer: "A person 10 years of age or older and under 17, or 17+ and under 18 with qualifying conduct",
                            explanation: "Texas Family Code 51.02(2) defines a 'child' as a person 10 years or older and under 17, or 17+ and under 18 if the conduct occurred before turning 17. <br><a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>Read FC 51.02</a>",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(2)</a>"
                        },
                        {
                            question: "Which of the following is a 'status offense'?",
                            options: [
                                "Burglary",
                                "Truancy",
                                "Aggravated assault",
                                "DWI"
                            ],
                            answer: "Truancy",
                            explanation: "A status offense is conduct that would not be a crime if committed by an adult, such as truancy, running away, or certain minor-only violations. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(15)</a> and <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.03' target='_blank' class='text-indigo-600 hover:underline'>FC 51.03(b)</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(15)</a>"
                        },
                        {
                            question: "What is a 'nonoffender' under the Family Code?",
                            options: [
                                "A child who commits a felony",
                                "A child subject to court jurisdiction for abuse/neglect or held solely for deportation",
                                "A child who is a habitual truant",
                                "A child who violates a traffic ordinance"
                            ],
                            answer: "A child subject to court jurisdiction for abuse/neglect or held solely for deportation",
                            explanation: "A nonoffender is a child involved in the court system for reasons other than criminal conduct, such as abuse/neglect or immigration. <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>Read FC 51.02(8)</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(8)</a>"
                        },
                        {
                            question: "Which of the following is NOT a valid court order under the Family Code?",
                            options: [
                                "An order entered under Section 54.04 for a status offender",
                                "A verbal warning from a police officer",
                                "A written order from a juvenile court judge",
                                "A court order for supervision after adjudication"
                            ],
                            answer: "A verbal warning from a police officer",
                            explanation: "A valid court order must be entered by a court, not simply a verbal warning from law enforcement. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(17)</a> for the definition of valid court order.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(17)</a>"
                        },
                        {
                            question: "What is the difference between a secure correctional facility and a secure detention facility?",
                            options: [
                                "Correctional is for adjudicated juveniles, detention is for accused juveniles",
                                "Detention is for adults only",
                                "Correctional is for adults only",
                                "There is no difference"
                            ],
                            answer: "Correctional is for adjudicated juveniles, detention is for accused juveniles",
                            explanation: "A secure correctional facility is for juveniles who have been adjudicated (found delinquent), while a secure detention facility is for temporary holding of accused juveniles. <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(13)-(14)</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(13)-(14)</a>"
                        },
                        {
                            question: "Which of the following is NOT a status offense?",
                            options: [
                                "Running away",
                                "TABC violation applicable only to minors",
                                "Class C traffic offense",
                                "Student code of conduct violation"
                            ],
                            answer: "Class C traffic offense",
                            explanation: "Traffic offenses are specifically excluded from status offenses. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(15)</a> and <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.03' target='_blank' class='text-indigo-600 hover:underline'>FC 51.03(b)</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(15)</a>"
                        },
                        {
                            question: "What is the minimum age for a person to be considered a 'child' under the Texas Family Code?",
                            options: ["8", "10", "12", "14"],
                            answer: "10",
                            explanation: "A child is defined as a person 10 years of age or older. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(2)</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.02' target='_blank' class='text-indigo-600 hover:underline'>FC 51.02(2)</a>"
                        },
                        {
                            question: "Which of the following is a requirement for a valid nonsecure custody for a JP/municipal offense?",
                            options: ["Unlocked area", "No physical restraints", "Continuous visual supervision", "All of the above"],
                            answer: "All of the above",
                            explanation: "Nonsecure custody must be in an unlocked area, with no restraints, and under constant supervision. See <a href='https://statutes.capitol.texas.gov/Docs/CN/htm/CN.45A.htm#45A.453' target='_blank' class='text-indigo-600 hover:underline'>CCP 45A.453</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/CN/htm/CN.45A.htm#45A.453' target='_blank' class='text-indigo-600 hover:underline'>CCP 45A.453</a>"
                        },
                        {
                            question: "Which of the following is NOT a right of a party in a juvenile proceeding?",
                            options: ["Right to a fair hearing", "Right to have constitutional rights recognized", "Right to be tried as an adult", "Right to legal counsel"],
                            answer: "Right to be tried as an adult",
                            explanation: "Juvenile proceedings are civil in nature and do not guarantee a right to be tried as an adult. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.01' target='_blank' class='text-indigo-600 hover:underline'>FC 51.01</a> and <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.10' target='_blank' class='text-indigo-600 hover:underline'>FC 51.10</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.01' target='_blank' class='text-indigo-600 hover:underline'>FC 51.01</a>, <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.10' target='_blank' class='text-indigo-600 hover:underline'>FC 51.10</a>"
                        },
                        {
                            question: "Which of the following is a difference between adult and juvenile case terminology?",
                            options: ["Arrest Warrant vs. Directive to Apprehend", "Defendant vs. Respondent", "Conviction vs. Adjudication", "All of the above"],
                            answer: "All of the above",
                            explanation: "Juvenile and adult courts use different terms for similar concepts. For example, a juvenile is 'taken into custody' instead of 'arrested.' See the Adult vs. Juvenile section in the handout.",
                            reference: "Juvenile-Procedure.txt, Adult vs. Juvenile section"
                        },
                        {
                            question: "Which of the following is NOT a possible outcome of a juvenile disposition hearing?",
                            options: ["Probation", "Commitment to TJJD", "Imprisonment in TDCJ for a misdemeanor", "Dismissal"],
                            answer: "Imprisonment in TDCJ for a misdemeanor",
                            explanation: "Juvenile misdemeanors do not result in TDCJ imprisonment. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.54.htm#54.04' target='_blank' class='text-indigo-600 hover:underline'>FC 54.04</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.54.htm#54.04' target='_blank' class='text-indigo-600 hover:underline'>FC 54.04</a>"
                        },
                        {
                            question: "Which of the following is a requirement for a valid field release of a juvenile?",
                            options: ["Release to a responsible adult", "Written promise to appear", "Offense is fine-only or traffic", "All of the above"],
                            answer: "All of the above",
                            explanation: "All these are required for a valid field release. See <a href='https://statutes.capitol.texas.gov/Docs/CN/htm/CN.14.htm#14.06' target='_blank' class='text-indigo-600 hover:underline'>CCP 14.06</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/CN/htm/CN.14.htm#14.06' target='_blank' class='text-indigo-600 hover:underline'>CCP 14.06</a>"
                        },
                        {
                            question: "Which of the following is a possible reason for holding a juvenile in detention?",
                            options: ["Likely to abscond", "Lacks adequate supervision", "Danger to self or public", "All of the above"],
                            answer: "All of the above",
                            explanation: "Detention may be ordered for risk of absconding, lack of supervision, or danger to self/public. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.54.htm#54.01' target='_blank' class='text-indigo-600 hover:underline'>FC 54.01(e)</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.54.htm#54.01' target='_blank' class='text-indigo-600 hover:underline'>FC 54.01(e)</a>"
                        },
                        {
                            question: "Which of the following is NOT a purpose of the juvenile justice code?",
                            options: ["To provide for the care and protection of children", "To punish children as adults", "To provide treatment and rehabilitation", "To ensure fair judicial procedures"],
                            answer: "To punish children as adults",
                            explanation: "The code emphasizes care, protection, and rehabilitation, not adult punishment. See <a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.01' target='_blank' class='text-indigo-600 hover:underline'>FC 51.01</a>.",
                            reference: "<a href='https://statutes.capitol.texas.gov/Docs/FA/htm/FA.51.htm#51.01' target='_blank' class='text-indigo-600 hover:underline'>FC 51.01</a>"
                        }
            ,
            // --- Additional comprehensive questions below ---
            {
                question: "Which of the following is a status offense?",
                options: ["Burglary", "Truancy", "Assault", "DWI"],
                answer: "Truancy",
                explanation: "Status offenses are acts that are only illegal due to the minor's age, such as truancy, running away, or curfew violations.",
                reference: "FC 51.02(15); FC 51.03(b)"
            },
            {
                question: "Who is considered a 'nonoffender' under the Family Code?",
                options: ["A child who commits a felony", "A child subject to court jurisdiction for abuse/neglect or held solely for deportation", "A child who commits a status offense", "A child who is a habitual truant"],
                answer: "A child subject to court jurisdiction for abuse/neglect or held solely for deportation",
                explanation: "Nonoffenders are children involved in the court system for reasons other than criminal conduct, such as abuse/neglect or immigration.",
                reference: "FC 51.02(11)"
            },
            {
                question: "Which of the following is NOT a right of a parent under FC 151.001?",
                options: ["To consent to medical care", "To designate the child's residence", "To commit the child to jail without due process", "To receive child support payments"],
                answer: "To commit the child to jail without due process",
                explanation: "Parents have many rights, but cannot unilaterally commit a child to jail without legal process.",
                reference: "FC 151.001"
            },
            {
                question: "What is the maximum time a child may be held in nonsecure custody for a JP/municipal offense?",
                options: ["2 hours", "6 hours", "12 hours", "24 hours"],
                answer: "6 hours",
                explanation: "Nonsecure custody for JP/municipal offenses is limited to 6 hours, and the child must not be physically restrained.",
                reference: "CCP 45A.453"
            },
            {
                question: "Who must be notified within 24 hours when a student is arrested for a felony?",
                options: ["The student's parent", "The school superintendent or designee", "The school board", "The student's teacher"],
                answer: "The school superintendent or designee",
                explanation: "CCP 15.27 requires law enforcement to notify the superintendent or designee within 24 hours of a felony arrest or referral.",
                reference: "CCP 15.27"
            },
            {
                question: "What is the penalty for unauthorized disclosure of school notification information?",
                options: ["Class A misdemeanor", "Class B misdemeanor", "Class C misdemeanor", "Felony"],
                answer: "Class C misdemeanor",
                explanation: "Unauthorized disclosure of confidential school notification information is a Class C misdemeanor.",
                reference: "CCP 15.27"
            },
            {
                question: "Which of the following is a requirement for a valid juvenile confession?",
                options: ["Given in the presence of a law enforcement officer", "Given after warnings by a magistrate", "Given without any warnings", "Given only to a parent"],
                answer: "Given after warnings by a magistrate",
                explanation: "Juvenile confessions must be preceded by warnings from a magistrate, not just law enforcement.",
                reference: "FC 51.095"
            },
            {
                question: "Which of the following is a right at a juvenile adjudication hearing?",
                options: ["Right to a jury trial", "Right to remain silent", "Right to confront witnesses", "All of the above"],
                answer: "All of the above",
                explanation: "Juveniles have the right to a jury, to remain silent, and to confront witnesses at adjudication.",
                reference: "FC 54.03"
            },
            {
                question: "What is the minimum age for a child to be certified as an adult for a first-degree felony?",
                options: ["10", "12", "14", "16"],
                answer: "14",
                explanation: "A child must be at least 14 years old to be certified as an adult for a first-degree felony.",
                reference: "FC 54.02(a)(2)(A)"
            },
            {
                question: "Which of the following is a risk factor for youth gang involvement?",
                options: ["Lack of parental supervision", "Peer pressure", "Community disorganization", "All of the above"],
                answer: "All of the above",
                explanation: "Risk factors for gang involvement include individual, family, peer, school, and community factors.",
                reference: "Youth Gangs section, handout"
            },
            {
                question: "Which of the following is NOT a valid reason for detention of a juvenile?",
                options: ["No suitable supervision", "Danger to self or public", "To punish the child", "Risk of absconding"],
                answer: "To punish the child",
                explanation: "Detention is not for punishment, but for safety, supervision, and court appearance reasons.",
                reference: "FC 53.02"
            },
            {
                question: "What is the purpose of a detention hearing?",
                options: ["To determine guilt or innocence", "To determine if continued detention is necessary", "To sentence the child", "To appoint a guardian"],
                answer: "To determine if continued detention is necessary",
                explanation: "Detention hearings are to review the need for continued detention, not to determine guilt.",
                reference: "FC 54.01"
            },
            {
                question: "Which of the following is a possible outcome of a disposition hearing?",
                options: ["Probation", "Commitment to TJJD", "Dismissal", "All of the above"],
                answer: "All of the above",
                explanation: "Disposition hearings can result in probation, commitment, or dismissal, among other outcomes.",
                reference: "FC 54.04"
            },
            {
                question: "What is the difference between a secure detention facility and a secure correctional facility?",
                options: ["Detention is for temporary holding, correctional is for adjudicated juveniles", "There is no difference", "Correctional is for adults only", "Detention is for adults only"],
                answer: "Detention is for temporary holding, correctional is for adjudicated juveniles",
                explanation: "Detention is for pre-adjudication, correctional is for post-adjudication placement.",
                reference: "FC 51.02(7)-(8)"
            },
            {
                question: "Which of the following is a requirement for nonsecure custody?",
                options: ["Unlocked area", "No physical restraints", "Continuous visual supervision", "All of the above"],
                answer: "All of the above",
                explanation: "Nonsecure custody must be in an unlocked area, with no restraints, and under constant supervision.",
                reference: "CCP 45A.453"
            },
            {
                question: "What is the first step in the juvenile process flowchart?",
                options: ["Referral to juvenile court", "Law enforcement/citizen complaint", "Detention hearing", "Adjudication hearing"],
                answer: "Law enforcement/citizen complaint",
                explanation: "The process begins with a complaint or referral to authorities.",
                reference: "Process Flowcharts section"
            },
            {
                question: "Which of the following is a difference between adult and juvenile court terminology?",
                options: ["Defendant vs. Respondent", "Conviction vs. Adjudication", "Sentencing vs. Disposition", "All of the above"],
                answer: "All of the above",
                explanation: "Juvenile and adult courts use different terms for similar concepts.",
                reference: "Process Flowcharts section"
            },
            {
                question: "Who may waive a child's rights in a juvenile proceeding?",
                options: ["The child alone", "The child's attorney alone", "The child and the child's attorney", "The child's parent"],
                answer: "The child and the child's attorney",
                explanation: "Both the child and their attorney must agree to waive rights in juvenile proceedings.",
                reference: "FC 51.09"
            },
            {
                question: "What is required for a polygraph examination of a child in custody?",
                options: ["Consent of the child's attorney or juvenile court", "Consent of the parent", "No consent required", "Only law enforcement approval"],
                answer: "Consent of the child's attorney or juvenile court",
                explanation: "A polygraph requires consent from the child's attorney or the court.",
                reference: "FC 51.151"
            },
            {
                question: "Which of the following is a possible penalty for failure to report suspected child abuse?",
                options: ["Class A misdemeanor", "Class B misdemeanor", "Class C misdemeanor", "Felony"],
                answer: "Class A misdemeanor",
                explanation: "Failure to report suspected child abuse is a Class A misdemeanor in Texas.",
                reference: "FC 261.109"
            },
            {
                question: "Which of the following is a valid reason for a field release of a juvenile?",
                options: ["Fine-only offense", "Felony offense", "Violent offense", "All of the above"],
                answer: "Fine-only offense",
                explanation: "Field release is allowed for fine-only or traffic offenses, not for felonies or violence.",
                reference: "CCP 14.06"
            },
            {
                question: "What is the maximum fine for contempt in JP/municipal court for a child?",
                options: ["$100", "$250", "$500", "$1000"],
                answer: "$500",
                explanation: "The maximum fine for contempt in JP/municipal court is $500.",
                reference: "CCP 45A.457"
            },
            {
                question: "Which of the following is a requirement for school notification under CCP 15.27?",
                options: ["Oral notice within 24 hours", "Written notice within 7 days", "Both oral and written notice", "All of the above"],
                answer: "All of the above",
                explanation: "Both oral and written notice are required for school notification under CCP 15.27.",
                reference: "CCP 15.27"
            },
            {
                question: "What is the penalty for unauthorized disclosure of confidential juvenile information?",
                options: ["Class A misdemeanor", "Class B misdemeanor", "Class C misdemeanor", "Felony"],
                answer: "Class C misdemeanor",
                explanation: "Unauthorized disclosure of confidential juvenile information is a Class C misdemeanor.",
                reference: "FC 58.007"
            },
            {
                question: "Which of the following is a requirement for a valid school notification?",
                options: ["Marked 'PERSONAL and CONFIDENTIAL'", "Sent to the student's teacher", "Sent to the school board", "None of the above"],
                answer: "Marked 'PERSONAL and CONFIDENTIAL'",
                explanation: "Written school notifications must be marked 'PERSONAL and CONFIDENTIAL'.",
                reference: "CCP 15.27"
            },
            {
                question: "Which of the following is a requirement for a valid juvenile record sealing?",
                options: ["No pending charges", "No adult felony convictions", "Sufficient time since discharge", "All of the above"],
                answer: "All of the above",
                explanation: "All these conditions must be met for record sealing.",
                reference: "FC 58.256"
            },
            {
                question: "Which of the following is a possible outcome of a juvenile court finding?",
                options: ["Adjudication", "Dismissal", "Supervision", "All of the above"],
                answer: "All of the above",
                explanation: "Juvenile court findings can result in adjudication, dismissal, or supervision.",
                reference: "FC 54.03, 54.04"
            },
            {
                question: "What is the purpose of the 'sight and sound' separation rule?",
                options: ["To keep juveniles from seeing or hearing adult inmates", "To keep parents away from children", "To separate boys and girls", "To separate staff from juveniles"],
                answer: "To keep juveniles from seeing or hearing adult inmates",
                explanation: "Sight and sound separation is required to protect juveniles from adult inmates.",
                reference: "FC 51.12(f)"
            },
            {
                question: "Which of the following is a requirement for a valid field release?",
                options: ["Release to a responsible adult", "Written promise to appear", "Offense is fine-only or traffic", "All of the above"],
                answer: "All of the above",
                explanation: "All these are required for a valid field release.",
                reference: "CCP 14.06"
            },
            {
                question: "Which of the following is a requirement for a valid juvenile processing office?",
                options: ["Designated by the juvenile board", "Not a cell or holding facility", "No child left unattended", "All of the above"],
                answer: "All of the above",
                explanation: "A juvenile processing office must meet all these requirements.",
                reference: "FC 52.025"
            },
            {
                question: "Which of the following is a requirement for a valid nonsecure custody?",
                options: ["Unlocked area", "No physical restraints", "Continuous visual supervision", "All of the above"],
                answer: "All of the above",
                explanation: "Nonsecure custody must be in an unlocked area, with no restraints, and under constant supervision.",
                reference: "CCP 45A.453"
            },
            {
                question: "Which of the following is a requirement for a valid school notification?",
                options: ["Oral notice within 24 hours", "Written notice within 7 days", "Marked 'PERSONAL and CONFIDENTIAL'", "All of the above"],
                answer: "All of the above",
                explanation: "All these are required for a valid school notification.",
                reference: "CCP 15.27"
            }
        ];

        // --- State Variables ---
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let originalOrder = [];

        // --- Functions ---
        function startQuiz() {
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            reviewSection.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // Store original order for review, then shuffle
            originalOrder = [...quizData];
            quizData.sort(() => Math.random() - 0.5);
            
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            
            showQuestion();
            updateScoreCounter();
        }

        function showQuestion() {
            resetState();
            const currentQuestion = quizData[currentQuestionIndex];
            questionText.innerText = currentQuestion.question;
            questionCounter.innerText = `Question ${currentQuestionIndex + 1} of ${quizData.length}`;
            
            // Create and display options
            currentQuestion.options.forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.classList.add('w-full', 'text-left', 'p-4', 'border', 'rounded-lg', 'transition-colors', 'duration-200', 'hover:bg-indigo-100', 'hover:border-indigo-400');
                button.addEventListener('click', () => selectAnswer(button, option));
                optionsContainer.appendChild(button);
            });
        }

        function resetState() {
            nextBtn.disabled = true;
            nextBtn.innerText = 'Next Question';
            while (optionsContainer.firstChild) {
                optionsContainer.removeChild(optionsContainer.firstChild);
            }
        }

        function selectAnswer(button, selectedOption) {
            const currentQuestion = quizData[currentQuestionIndex];
            const correct = selectedOption === currentQuestion.answer;

            // Find the original index of the current question for storing the answer
            const originalIndex = originalOrder.findIndex(q => q.question === currentQuestion.question);
            userAnswers[originalIndex] = {
                question: currentQuestion.question,
                selected: selectedOption,
                correctAnswer: currentQuestion.answer,
                isCorrect: correct,
                explanation: currentQuestion.explanation,
                reference: currentQuestion.reference
            };

            if (correct) {
                score++;
            }
            scoreCounter.innerText = `Score: ${score} / ${currentQuestionIndex + 1}`;
            
            Array.from(optionsContainer.children).forEach(child => {
                child.disabled = true;
                if (child.innerText === currentQuestion.answer) {
                    child.classList.add('correct', 'font-bold');
                } else if (child.innerText === selectedOption) {
                    child.classList.add('incorrect', 'font-bold');
                }
            });

            const explanationEl = document.createElement('div');
            explanationEl.innerHTML = `
                <p class="font-semibold mt-4">Explanation:</p>
                <p>${currentQuestion.explanation}</p>
                <div class="mt-2 pt-2 border-t border-gray-300">
                    <p class="font-semibold">Reference:</p>
                    <p class="text-sm">${currentQuestion.reference}</p>
                </div>
            `;
            explanationEl.classList.add('explanation', 'p-4', 'rounded-lg', 'mt-4');
            optionsContainer.appendChild(explanationEl);

            nextBtn.disabled = false;
            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.innerText = 'Show Results';
            }
        }

        function handleNextButton() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            finalScore.innerText = `${score} / ${quizData.length}`;
            
            const percentage = (score / quizData.length) * 100;
            if (percentage >= 80) {
                scoreMessage.innerText = "Excellent work! You have a strong grasp of the material.";
            } else if (percentage >= 60) {
                scoreMessage.innerText = "Good job! A little more review could be beneficial.";
            } else {
                scoreMessage.innerText = "It might be a good idea to review the handout again. Keep trying!";
            }
        }
        
        function updateScoreCounter() {
             scoreCounter.innerText = `Score: ${score} / ${currentQuestionIndex}`;
        }

        function showReview() {
            reviewContainer.innerHTML = ''; 
            
            // Use the userAnswers array which is now indexed correctly
            userAnswers.forEach((answer, index) => {
                if (!answer) return; // Skip if a question was somehow not answered

                const card = document.createElement('div');
                card.classList.add('bg-white', 'p-6', 'rounded-xl', 'shadow-md');
                
                const isCorrect = answer.isCorrect;
                const resultClass = isCorrect ? 'text-green-600' : 'text-red-600';
                const resultText = isCorrect ? 'Correct' : 'Incorrect';

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">Question ${index + 1}</h3>
                        <span class="font-bold ${resultClass}">${resultText}</span>
                    </div>
                    <p class="font-medium text-gray-700 mb-4">${answer.question}</p>
                    <div class="space-y-2 text-sm">
                        <p><strong>Your Answer:</strong> <span class="${!isCorrect ? 'text-red-600' : ''}">${answer.selected}</span></p>
                        <p><strong>Correct Answer:</strong> <span class="text-green-700">${answer.correctAnswer}</span></p>
                        <div class="explanation p-3 rounded-md mt-3">
                            <p class="font-semibold">Explanation:</p>
                            <p>${answer.explanation}</p>
                            <div class="mt-2 pt-2 border-t border-gray-300">
                                <p class="font-semibold">Reference:</p>
                                <p class="text-sm">${answer.reference}</p>
                            </div>
                        </div>
                    </div>
                `;
                reviewContainer.appendChild(card);
            });
            reviewSection.classList.remove('hidden');
            reviewSection.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', startQuiz);
        nextBtn.addEventListener('click', handleNextButton);
        restartBtn.addEventListener('click', startQuiz);
        reviewBtn.addEventListener('click', showReview);

    </script>
</body>
</html>
