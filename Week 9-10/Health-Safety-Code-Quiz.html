<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health and Safety Code Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .correct {
            background-color: #d1fae5; /* green-100 */
            border-color: #10b981; /* green-500 */
        }
        .incorrect {
            background-color: #fee2e2; /* red-100 */
            border-color: #ef4444; /* red-500 */
        }
        .explanation {
            background-color: #f3f4f6; /* gray-100 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="quiz-container" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white p-8 rounded-2xl shadow-lg">
            <h1 class="text-3xl font-bold text-center text-gray-900 mb-2">Health and Safety Code Quiz</h1>
            <p class="text-center text-gray-500 mb-8">Practice Version: Review answers as you go.</p>

            <div id="start-screen">
                <p class="text-lg mb-6 text-center">This ultimate final practice quiz now contains an exhaustive list of questions covering every detail from your handout. After each answer, you'll see a detailed explanation with references. Click "Start Practice" to begin.</p>
                <button id="start-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 text-lg">Start Practice</button>
            </div>

            <div id="quiz-screen" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <div id="question-counter" class="text-sm font-semibold text-gray-600"></div>
                    <div id="score-counter" class="text-sm font-semibold text-gray-600">Score: 0 / 0</div>
                </div>
                <div id="question-card" class="mb-6 p-6 bg-gray-50 rounded-xl border border-gray-200">
                    <h2 id="question-text" class="text-xl font-semibold mb-5"></h2>
                    <div id="options-container" class="space-y-3"></div>
                </div>
                <button id="next-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300 disabled:bg-gray-400" disabled>Next Question</button>
            </div>

            <div id="result-screen" class="hidden text-center">
                <h2 class="text-2xl font-bold mb-4">Practice Complete!</h2>
                <p class="text-5xl font-bold mb-4" id="final-score"></p>
                <p class="text-lg text-gray-600 mb-8" id="score-message"></p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="restart-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Restart Practice</button>
                    <button id="review-btn" class="w-full sm:w-auto bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors duration-300">Review All Answers</button>
                </div>
            </div>
        </div>

        <div id="review-section" class="hidden mt-8">
             <h2 class="text-2xl font-bold text-center mb-6">Answer Review</h2>
             <div id="review-container" class="space-y-6"></div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        
        const questionCounter = document.getElementById('question-counter');
        const scoreCounter = document.getElementById('score-counter');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        const finalScore = document.getElementById('final-score');
        const scoreMessage = document.getElementById('score-message');
        
        const reviewSection = document.getElementById('review-section');
        const reviewContainer = document.getElementById('review-container');

        // --- Quiz Data with References ---
        const quizData = [
            {
                question: "Under HSC 481.002, what does the term 'Controlled Substance' include besides the drug itself?",
                options: ["Only the pure drug compound.", "The aggregate weight of any mixture, solution, or other substance containing the controlled substance.", "The packaging and any paraphernalia found with the drug.", "Only substances listed in federal schedules."],
                answer: "The aggregate weight of any mixture, solution, or other substance containing the controlled substance.",
                explanation: "This is a critical definition for charging purposes. The total weight of the entire substance (including cutting agents, adulterants, and dilutants) is used to determine the penalty level, not just the weight of the pure narcotic.",
                reference: "Handout Page 1: HSC 481.002(5) - 'Includes the aggregate weight of any mixture, solution, or other substance containing a controlled substance...'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.002' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.002</a>"
            },
            {
                question: "What is a 'Controlled substance analogue'?",
                options: ["A legal, over-the-counter version of a controlled substance.", "A substance with a chemical structure or effect substantially similar to a Penalty Group 1, 1-A, or 2 substance.", "Any substance that is not a controlled substance.", "A counterfeit substance with a fake trademark."],
                answer: "A substance with a chemical structure or effect substantially similar to a Penalty Group 1, 1-A, or 2 substance.",
                explanation: "This definition allows the law to cover 'designer drugs' that are created to mimic the effects of illegal substances but may not be specifically listed in the penalty groups.",
                reference: "Handout Page 1: HSC 481.002(6) - Defines a controlled substance analogue."
            },
            {
                question: "What defines a 'Counterfeit substance' under the HSC?",
                options: ["A substance that looks like a controlled substance but has no effect.", "A controlled substance that, without authorization, bears the trademark or label of a legitimate manufacturer.", "Any illegally manufactured drug.", "A legal substance sold as an illegal one."],
                answer: "A controlled substance that, without authorization, bears the trademark or label of a legitimate manufacturer.",
                explanation: "The key element is the fraudulent labeling or marking of a controlled substance to pass it off as a product from a different, legitimate source.",
                reference: "Handout Page 2: HSC 481.002(7) - Defines 'Counterfeit substance'."
            },
            {
                question: "What does the term 'Manufacture' exclude?",
                options: ["Chemical synthesis of a new drug.", "Packaging or repackaging of a substance.", "The preparation or compounding of a controlled substance by a practitioner for administering to a patient.", "Extracting a substance from a plant."],
                answer: "The preparation or compounding of a controlled substance by a practitioner for administering to a patient.",
                explanation: "'Manufacture' refers to illegal production. It specifically excludes the legitimate activities of a practitioner in the course of their professional practice.",
                reference: "Handout Page 2: HSC 481.002(25) - Explains what 'Manufacture' does not include."
            },
            {
                question: "What is the key difference between the definitions of 'Deliver' and 'Distribute'?",
                options: ["'Deliver' includes an offer to sell, while 'Distribute' does not.", "'Distribute' is for large quantities, while 'Deliver' is for small quantities.", "'Deliver' is a legal term, while 'Distribute' is a slang term.", "'Distribute' means to deliver a controlled substance *other than* by administering or dispensing it."],
                answer: "'Distribute' means to deliver a controlled substance *other than* by administering or dispensing it.",
                explanation: "'Deliver' is a broad term for any transfer, including an offer to sell. 'Distribute' is a specific type of delivery that is not part of a legitimate medical practice (administering/dispensing).",
                reference: "Handout Page 3: Compares the definitions of Deliver and Distribute."
            },
            {
                question: "How is 'Administer' defined in the Health and Safety Code?",
                options: ["Handing a prescription to a patient.", "Selling a controlled substance.", "The direct application of a controlled substance to a patient's body by a practitioner.", "Writing a prescription for a controlled substance."],
                answer: "The direct application of a controlled substance to a patient's body by a practitioner.",
                explanation: "'Administer' refers to the actual act of introducing the substance into the body, such as through injection or ingestion, under the direct supervision of a practitioner.",
                reference: "Handout Page 3: HSC 481.002(1) - Defines 'Administer'."
            },
            {
                question: "What is the legal definition of 'Possession' under the Health and Safety Code?",
                options: ["Ownership of a substance.", "Actual care, custody, control, or management.", "Being in the same room as a substance.", "Having knowledge of a substance's location."],
                answer: "Actual care, custody, control, or management.",
                explanation: "This is a critical legal standard. Possession is not just ownership; it's about having control over the substance. This can be 'actual' (on your person) or 'constructive' (in a place you control, like your car or house).",
                reference: "Handout Page 4: HSC 481.002(38) - '\"Possession\" means actual care, custody, control, or management.'"
            },
            {
                question: "What parts of the Cannabis sativa L. plant are excluded from the definition of 'Marihuana'?",
                options: ["The leaves and flowers.", "The mature stalks of the plant, fiber produced from the stalks, and sterilized seeds.", "The seeds and roots.", "Any part of the plant that has been dried."],
                answer: "The mature stalks of the plant, fiber produced from the stalks, and sterilized seeds.",
                explanation: "The legal definition of marihuana specifically excludes parts of the plant that have industrial uses and are not typically used for intoxication, as well as seeds that cannot germinate.",
                reference: "Handout Page 5: HSC 481.002(26) - Lists the exclusions from the definition of 'Marihuana'."
            },
            {
                question: "According to the Agriculture Code, what is the maximum legal delta-9 tetrahydrocannabinol (THC) concentration for a plant to be classified as 'Hemp'?",
                options: ["3.0 percent", "1.0 percent", "0.5 percent", "Not more than 0.3 percent"],
                answer: "Not more than 0.3 percent",
                explanation: "This specific THC threshold is the legal dividing line between non-controlled hemp and controlled marihuana.",
                reference: "Handout Page 5: Agriculture Code 121.001 - 'with a delta-9 tetrahydrocannabinol concentration of not more than 0.3 percent on a dry weight basis.'<br><a href='https://statutes.capitol.texas.gov/Docs/AG/htm/AG.121.htm#121.001' target='_blank' class='text-indigo-600 hover:underline'>Agriculture Code ยง 121.001</a>"
            },
            {
                question: "Which of the six major categories of controlled substances is known for slowing down the brain and body's functions?",
                options: ["Stimulants", "Hallucinogens", "Depressants", "Narcotics"],
                answer: "Depressants",
                explanation: "Depressants, such as alcohol, Xanax, and Valium, reduce excitability and calm the central nervous system.",
                reference: "Handout Page 7: 'Depressants: slows down the brain & body.'"
            },
            {
                question: "Heroin, Morphine, and OxyContin belong to which major drug category?",
                options: ["Stimulants", "Hallucinogens", "Depressants", "Narcotic analgesics"],
                answer: "Narcotic analgesics",
                explanation: "These are all opiates or opioids, which are classified as narcotic analgesics known for relieving pain and inducing euphoria.",
                reference: "Handout Page 7: The chart lists these examples under 'Narcotic analgesics'."
            },
            {
                question: "Cocaine and Methamphetamine belong to which major drug category?",
                options: ["Stimulants", "Depressants", "Hallucinogens", "Cannabis"],
                answer: "Stimulants",
                explanation: "These substances increase heart rate and blood pressure, causing excitement and alertness, which are characteristic effects of CNS stimulants.",
                reference: "Handout Page 9: 'CNS Stimulants' chart lists cocaine and methamphetamine as examples."
            },
            {
                question: "LSD, Peyote, and Psilocybin (mushrooms) belong to which major drug category?",
                options: ["Stimulants", "Depressants", "Hallucinogens", "Narcotics"],
                answer: "Hallucinogens",
                explanation: "These substances are known for distorting a person's senses and perception of reality.",
                reference: "Handout Page 10: 'Hallucinogens' chart lists these as examples."
            },
            {
                question: "Cocaine, Heroin, and Methamphetamine are all found in which Texas Penalty Group?",
                options: ["Penalty Group 1", "Penalty Group 2", "Penalty Group 3", "Penalty Group 4"],
                answer: "Penalty Group 1",
                explanation: "Penalty Group 1 contains many of the most dangerous and highly addictive narcotics and stimulants.",
                reference: "Handout Page 17: The 'Penalty Groups 1-3' chart lists these substances under Penalty Group 1."
            },
            {
                question: "Lysergic acid diethylamide (LSD) is the primary substance listed in which Penalty Group?",
                options: ["Penalty Group 1", "Penalty Group 1A", "Penalty Group 2", "Penalty Group 2A"],
                answer: "Penalty Group 1A",
                explanation: "Penalty Group 1A was created specifically for LSD, and its penalties are based on the number of abuse units (doses) rather than weight.",
                reference: "Handout Page 12 & 17: HSC 481.1021 - 'Penalty Group 1-A consists of: lysergic acid diethylamide (LSD)...'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.1021' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.1021</a>"
            },
            {
                question: "Fentanyl and its derivatives are listed in which Penalty Group?",
                options: ["Penalty Group 1", "Penalty Group 1B", "Penalty Group 2", "Penalty Group 3"],
                answer: "Penalty Group 1B",
                explanation: "Due to its extreme potency and danger, Fentanyl and its analogues were placed in their own penalty group, 1B, which carries severe penalties.",
                reference: "Handout Page 12: HSC 481.1022 - 'PENALTY GROUP 1-B.' lists Fentanyl.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.1022' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.1022</a>"
            },
            {
                question: "THC, other than marihuana, and synthetic cannabinoids (K2, Spice) are found in which two Penalty Groups, respectively?",
                options: ["PG 1 and PG 1A", "PG 2 and PG 2A", "PG 3 and PG 4", "PG 1 and PG 2"],
                answer: "PG 2 and PG 2A",
                explanation: "THC extracts like wax and oils are in Penalty Group 2. The man-made chemical compounds known as synthetic cannabinoids are in Penalty Group 2A.",
                reference: "Handout Page 13 & 14: 'Penalty Group 2: ...THC...'; 'PG2A SYNTHETIC CANNABINOIDS'."
            },
            {
                question: "Xanax (Alprazolam), Valium (Diazepam), and anabolic steroids are found in which Penalty Group?",
                options: ["Penalty Group 1", "Penalty Group 2", "Penalty Group 3", "Penalty Group 4"],
                answer: "Penalty Group 3",
                explanation: "Penalty Group 3 contains many commonly abused prescription medications, including depressants like benzodiazepines and anabolic steroids.",
                reference: "Handout Page 14 & 17: The charts list these substances under Penalty Group 3."
            },
            {
                question: "A person knowingly possesses less than one gram of cocaine. What is the penalty?",
                options: ["Class A Misdemeanor", "State Jail Felony", "Third Degree Felony", "Second Degree Felony"],
                answer: "State Jail Felony",
                explanation: "Possession of any amount of a Penalty Group 1 substance under one gram is a State Jail Felony.",
                reference: "Handout Page 19: HSC 481.115(b) - 'state jail felony if the amount... is... less than one gram.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.115' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.115</a>"
            },
            {
                question: "A person knowingly manufactures or delivers 3 grams of methamphetamine. What is the penalty?",
                options: ["State Jail Felony", "Third Degree Felony", "Second Degree Felony", "First Degree Felony"],
                answer: "Second Degree Felony",
                explanation: "Manufacture or Delivery of a Penalty Group 1 substance in an amount of one gram or more but less than four grams is a second-degree felony.",
                reference: "Handout Page 16: HSC 481.112(c) - 'felony of the second degree if the amount... is... one gram or more but less than four grams.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.112' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.112</a>"
            },
            {
                question: "What is the penalty for possessing 10 abuse units of LSD (Penalty Group 1A)?",
                options: ["Class A Misdemeanor", "State Jail Felony", "Third Degree Felony", "Second Degree Felony"],
                answer: "State Jail Felony",
                explanation: "Possession of fewer than 20 abuse units of a PG 1A substance is a State Jail Felony.",
                reference: "Handout Page 19: HSC 481.1151(b)(1) - 'state jail felony if the number of abuse units... is fewer than 20'.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.1151' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.1151</a>"
            },
            {
                question: "What is the penalty for possessing two ounces or less of a synthetic cannabinoid (Penalty Group 2A)?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "State Jail Felony"],
                answer: "Class B Misdemeanor",
                explanation: "The lowest-level possession offense for synthetic cannabinoids is a Class B Misdemeanor.",
                reference: "Handout Page 20: HSC 481.1161(b)(1) - 'Class B misdemeanor if the amount... is two ounces or less'.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.1161' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.1161</a>"
            },
            {
                question: "What is the penalty for possessing less than 28 grams of a Penalty Group 3 substance, such as Xanax without a prescription?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "State Jail Felony"],
                answer: "Class A Misdemeanor",
                explanation: "The lowest-level possession offense for a PG 3 substance is a Class A Misdemeanor.",
                reference: "Handout Page 20: HSC 481.117(b) - 'Class A misdemeanor if the amount... is... less than 28 grams.'"
            },
            {
                question: "What is the penalty for possessing two ounces or less of marihuana?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "No offense"],
                answer: "Class B Misdemeanor",
                explanation: "Possession of two ounces or less of marihuana is the most common marijuana charge and is a Class B Misdemeanor.",
                reference: "Handout Page 22: HSC 481.121(b)(1) - 'Class B misdemeanor if the amount... is two ounces or less'.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.121' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.121</a>"
            },
            {
                question: "A person delivers one-fourth of an ounce of marihuana to a friend and does not receive any money or remuneration. What is the offense level?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "State Jail Felony"],
                answer: "Class B Misdemeanor",
                explanation: "This is a specific provision for the non-commercial delivery of a small amount of marihuana, making it a Class B Misdemeanor. If the person had received payment, it would be a Class A Misdemeanor.",
                reference: "Handout Page 22: HSC 481.120(b)(1) - 'Class B misdemeanor if the amount... is one-fourth ounce or less and the person... does not receive remuneration...'"
            },
            {
                question: "Under the Texas Compassionate-Use Program, what is the maximum THC concentration for a substance to be considered 'low-THC cannabis'?",
                options: ["0.3 percent", "0.5 percent", "1.0 percent", "3.0 percent"],
                answer: "1.0 percent",
                explanation: "The Compassionate-Use Program allows for a slightly higher THC content (up to 1.0%) than what is legally defined as hemp (0.3%).",
                reference: "Handout Page 22: OC 169.001(3) - 'contains not more than one percent by weight of tetrahydrocannabinols.'<br><a href='https://statutes.capitol.texas.gov/Docs/OC/htm/OC.169.htm#169.001' target='_blank' class='text-indigo-600 hover:underline'>Occupations Code ยง 169.001</a>"
            },
            {
                question: "Which of the following is a qualifying medical condition for a prescription of low-THC cannabis under the Compassionate-Use Program?",
                options: ["Chronic back pain", "Anxiety", "Epilepsy, multiple sclerosis, or cancer", "Glaucoma"],
                answer: "Epilepsy, multiple sclerosis, or cancer",
                explanation: "The program is limited to a specific list of severe medical conditions, including epilepsy, MS, spasticity, ALS, autism, cancer, and incurable neurodegenerative diseases.",
                reference: "Handout Page 23: OC 169.003(3)(A) - Lists the qualifying conditions."
            },
            {
                question: "The 'overdose defense' provides an affirmative defense to prosecution for possession if the actor was the first person to request emergency medical assistance for a possible overdose and what other conditions were met?",
                options: ["They left the scene before police arrived.", "They remained on the scene and cooperated with medical and law enforcement personnel.", "They administered Narcan themselves.", "They had no prior arrests."],
                answer: "They remained on the scene and cooperated with medical and law enforcement personnel.",
                explanation: "This defense, designed to save lives, requires the person to stay and cooperate fully with first responders.",
                reference: "Handout Page 24: 'remained on the scene until the medical assistance arrived, and cooperated with medical assistance and law enforcement'."
            },
            {
                question: "The overdose defense is NOT available if, at the time of the call, a peace officer was in the process of arresting the actor or what else?",
                options: ["Conducting a traffic stop nearby.", "Executing a search warrant describing the actor or the place.", "Writing a report in their car.", "Investigating an unrelated call down the street."],
                answer: "Executing a search warrant describing the actor or the place.",
                explanation: "The defense does not apply if law enforcement action against the person was already underway when the call for help was made.",
                reference: "Handout Page 25: 'a peace officer was in the process of arresting the actor or executing a search warrant...'"
            },
            {
                question: "A person commits an offense under HSC 481.122 if they knowingly deliver a controlled substance or marihuana to a person who is a child (under 18) or what other category of person?",
                options: ["A person over 65.", "A person enrolled in a public or private primary or secondary school.", "A college student.", "An off-duty police officer."],
                answer: "A person enrolled in a public or private primary or secondary school.",
                explanation: "This statute creates a second-degree felony for delivering drugs to minors or to students in a school environment, regardless of the student's age.",
                reference: "Handout Page 25: HSC 481.122(a)(2) - 'is enrolled in a public or private primary or secondary school'.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.122' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.122</a>"
            },
            {
                question: "An intent to unlawfully manufacture methamphetamine is presumed if a person possesses certain precursors along with at least three other items. Which of the following is one of those items?",
                options: ["A large amount of cash.", "A firearm.", "Anhydrous ammonia.", "A stolen vehicle."],
                answer: "Anhydrous ammonia.",
                explanation: "The possession of key precursors and lab equipment creates a legal presumption that the person intended to manufacture methamphetamine.",
                reference: "Handout Page 26: HSC 481.124(b) - Lists the items that create the presumption.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.124' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.124</a>"
            },
            {
                question: "What is the penalty for knowingly or intentionally possessing drug paraphernalia with the intent to use it?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "No offense"],
                answer: "Class C Misdemeanor",
                explanation: "Possession of drug paraphernalia for personal use is a Class C Misdemeanor, punishable by a fine only.",
                reference: "Handout Page 27: HSC 481.125(d) - 'An offense under Subsection (a) is a Class C misdemeanor.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.125' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.125</a>"
            },
            {
                question: "The penalty for Delivery of Drug Paraphernalia is enhanced from a Class A Misdemeanor to a State Jail Felony under what circumstance?",
                options: ["If the paraphernalia is sold near a school.", "If the actor is 18 or older and delivers to a person younger than 18 who is at least 3 years younger.", "If the actor has any prior drug conviction.", "If the paraphernalia is for manufacturing drugs."],
                answer: "If the actor is 18 or older and delivers to a person younger than 18 who is at least 3 years younger.",
                explanation: "This enhancement specifically targets adults who provide drug paraphernalia to younger minors.",
                reference: "Handout Page 27: HSC 481.125(c) & (f) - 'An offense under Subsection (c) is a state jail felony.'"
            },
            {
                question: "A person commits an offense under HSC 481.133 if they knowingly deliver or possess with intent to deliver what?",
                options: ["A simulated controlled substance.", "A dangerous drug.", "A substance or device designed to falsify drug test results.", "An illegal prescription."],
                answer: "A substance or device designed to falsify drug test results.",
                explanation: "This statute criminalizes the sale of items like synthetic urine or adulterants that are intended to defeat a lawfully administered drug test.",
                reference: "Handout Page 28: HSC 481.133(b) - 'delivers, possesses with intent to deliver, or manufactures with intent to deliver a substance or device designed to falsify drug test results.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.133' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.133</a>"
            },
            {
                question: "Under HSC 481.141, if a person dies as a result of using a controlled substance delivered by a defendant, what happens to the punishment for the delivery offense?",
                options: ["It remains the same.", "The defendant is charged with Murder instead.", "The punishment for the delivery offense is increased by one degree.", "A mandatory life sentence is imposed."],
                answer: "The punishment for the delivery offense is increased by one degree.",
                explanation: "This statute provides a specific enhancement for drug dealers whose products cause death or serious bodily injury, increasing the felony level of the underlying delivery charge.",
                reference: "Handout Page 28: HSC 481.141(a) - 'the punishment for the offense is increased by one degree.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.481.htm#481.141' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 481.141</a>"
            },
            {
                question: "A person commits an offense under HSC 482.002 if they knowingly deliver a simulated controlled substance and do what?",
                options: ["Believe it is a real controlled substance.", "Represent it to be a controlled substance in a manner that would lead a reasonable person to believe it is.", "Sell it for more than its actual value.", "Deliver it to a minor."],
                answer: "Represent it to be a controlled substance in a manner that would lead a reasonable person to believe it is.",
                explanation: "The crime is not the substance itself, but the fraud. It's illegal to pass off a fake substance as a real controlled substance.",
                reference: "Handout Page 29: HSC 482.002(a)(2) - 'represents the substance to be a controlled substance in a manner that would lead a reasonable person to believe that the substance is a controlled substance'.<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.482.htm#482.002' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 482.002</a>"
            },
            {
                question: "What is the effect of a deadly weapon finding on a State Jail Felony drug offense?",
                options: ["It has no effect on the punishment.", "It enhances the punishment to a third-degree felony.", "It adds a mandatory 5-year sentence.", "It makes the person ineligible for probation."],
                answer: "It enhances the punishment to a third-degree felony.",
                explanation: "Under PC 12.35(c)(1), using a deadly weapon during the commission of a State Jail Felony elevates the punishment range to that of a third-degree felony.",
                reference: "Handout Page 29: 'PC 12.35(c)(1): SJF punished as a 3rd if a deadly weapon is used in the offense or immediate flight.'"
            },
            {
                question: "What is a 'Dangerous Drug' under HSC 483.001?",
                options: ["Any substance in Penalty Groups 1-4.", "A drug that is unsafe for self-medication and requires a prescription, but is not in a penalty group.", "Any illegal substance.", "Heroin, cocaine, and methamphetamine."],
                answer: "A drug that is unsafe for self-medication and requires a prescription, but is not in a penalty group.",
                explanation: "This category covers all prescription drugs that are not classified as controlled substances, such as antibiotics, blood pressure medication, etc.",
                reference: "Handout Page 33: HSC 483.001(2) - 'a device or a drug that is unsafe for self-medication and that is not included in Schedules I through V or Penalty Groups 1 through 4...'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.483.htm#483.001' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 483.001</a>"
            },
            {
                question: "What is the penalty for possessing a dangerous drug without a valid prescription?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "State Jail Felony"],
                answer: "Class A Misdemeanor",
                explanation: "Possession of a dangerous drug is a Class A Misdemeanor.",
                reference: "Handout Page 34: HSC 483.041(d) - 'An offense under this section is a Class A misdemeanor.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.483.htm#483.041' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 483.041</a>"
            },
            {
                question: "What is the penalty for delivering or offering to deliver a dangerous drug?",
                options: ["Class A Misdemeanor", "State Jail Felony", "Third Degree Felony", "Second Degree Felony"],
                answer: "State Jail Felony",
                explanation: "While simple possession is a misdemeanor, the delivery of a dangerous drug is a State Jail Felony.",
                reference: "Handout Page 35: HSC 483.042(d) - 'An offense under this section is a state jail felony.'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.483.htm#483.042' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 483.042</a>"
            },
            {
                question: "A person obtains a dangerous drug by using a forged prescription. What offense have they committed, and what is the penalty?",
                options: ["Theft, Class B Misdemeanor", "Forgery, State Jail Felony", "Forging or Altering Prescription (HSC 483.045), Class B Misdemeanor", "Possession of Dangerous Drug, Class A Misdemeanor"],
                answer: "Forging or Altering Prescription (HSC 483.045), Class B Misdemeanor",
                explanation: "HSC 483.045 specifically criminalizes prescription fraud. The base offense is a Class B Misdemeanor, enhanced to a Class A for a prior conviction under the chapter.",
                reference: "Handout Page 36: HSC 483.045 - 'obtains or attempts to obtain a dangerous drug by using a forged... prescription... An offense under this section is a Class B misdemeanor...'<br><a href='https://statutes.capitol.texas.gov/Docs/HS/htm/HS.483.htm#483.045' target='_blank' class='text-indigo-600 hover:underline'>HSC ยง 483.045</a>"
            },
            {
                question: "What is the key difference regarding accomplice testimony between dangerous drug cases (HSC 483) and controlled substance cases (HSC 481)?",
                options: ["There is no difference.", "In dangerous drug cases, a conviction CAN be obtained on uncorroborated accomplice testimony; in controlled substance cases, it CANNOT.", "In controlled substance cases, a conviction CAN be obtained on uncorroborated accomplice testimony; in dangerous drug cases, it CANNOT.", "Accomplice testimony is not allowed in either type of case."],
                answer: "In dangerous drug cases, a conviction CAN be obtained on uncorroborated accomplice testimony; in controlled substance cases, it CANNOT.",
                explanation: "This is a significant legal distinction. HSC 483.072 specifically allows for conviction on uncorroborated testimony for dangerous drugs, while CCP 38.14 (the general rule) and CCP 38.141 (for undercover agents) require corroboration for controlled substance cases.",
                reference: "Handout Page 38: Compares HSC 483.072 (Uncorroborated Testimony) with CCP 38.14 (Testimony of Accomplice)."
            },
            {
                question: "A person who is not a licensed peace officer is acting covertly for a law enforcement agency. Under CCP 38.141, can a defendant be convicted of a controlled substance offense based on this person's testimony alone?",
                options: ["Yes, their testimony is sufficient.", "No, the testimony must be corroborated by other evidence tending to connect the defendant to the offense.", "Only if the person is a registered confidential informant.", "Only for misdemeanor offenses."],
                answer: "No, the testimony must be corroborated by other evidence tending to connect the defendant to the offense.",
                explanation: "This statute provides a safeguard, requiring that the testimony of a non-officer undercover agent or informant be supported by other independent evidence linking the defendant to the crime.",
                reference: "Handout Page 39: CCP 38.141 - 'A defendant may not be convicted... on the testimony of a person who is not a licensed peace officer... unless the testimony is corroborated by other evidence...'<br><a href='https://statutes.capitol.texas.gov/Docs/CN/htm/CN.38.htm#38.141' target='_blank' class='text-indigo-600 hover:underline'>Texas Code of Criminal Procedure Art. 38.141</a>"
            },
            {
                question: "What is the penalty for manufacturing a substance in Penalty Group 1 if a child younger than 18 is present on the premises?",
                options: ["The penalty is increased by one degree.", "It becomes an automatic first-degree felony.", "A mandatory 25-year sentence is added.", "The penalty is doubled."],
                answer: "The penalty is increased by one degree.",
                explanation: "HSC 481.1122 provides a specific enhancement for endangering a child during the manufacture of a PG 1 substance, increasing the punishment by one felony degree.",
                reference: "Handout Page 17: HSC 481.1122 - 'the punishments... are increased by one degree.'"
            },
            {
                question: "What is the penalty for possessing more than 4 ounces but less than 5 pounds of marihuana?",
                options: ["Class A Misdemeanor", "State Jail Felony", "Third Degree Felony", "Second Degree Felony"],
                answer: "State Jail Felony",
                explanation: "Possession of marihuana in this weight range is a State Jail Felony.",
                reference: "Handout Page 22: HSC 481.121(b)(3) - 'state jail felony if the amount... is five pounds or less but more than four ounces'."
            },
            {
                question: "What is the penalty for delivering more than 50 pounds but less than 2,000 pounds of marihuana?",
                options: ["State Jail Felony", "Third Degree Felony", "Second Degree Felony", "First Degree Felony"],
                answer: "First Degree Felony",
                explanation: "Delivery of a large quantity of marihuana (50-2,000 lbs) is a first-degree felony.",
                reference: "Handout Page 22: HSC 481.120(b)(5) - 'felony of the first degree if the amount... is 2,000 pounds or less but more than 50 pounds'."
            },
            {
                question: "What is the penalty for possessing a substance in Penalty Group 4 in an amount less than 28 grams?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "State Jail Felony"],
                answer: "Class B Misdemeanor",
                explanation: "The lowest level offense for possessing a PG 4 substance is a Class B Misdemeanor.",
                reference: "Handout Page 21: HSC 481.118(b) - 'Class B misdemeanor if the amount... is... less than 28 grams.'"
            },
            {
                question: "What is the penalty for distributing, selling, or exposing for sale a kratom product to a minor (under 18)?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "No offense, kratom is legal."],
                answer: "Class C Misdemeanor",
                explanation: "HSC 444.004 makes it a Class C Misdemeanor to sell or distribute kratom to a person younger than 18 years of age.",
                reference: "Handout Page 26: HSC 444.004 - 'person distributes, sells, or exposes for sale a kratom product to an individual younger than 18 years of age. (b) class c'"
            },
            {
                question: "What is the penalty for a pharmacist refilling a prescription for a dangerous drug without authorization?",
                options: ["Class C Misdemeanor", "Class B Misdemeanor", "Class A Misdemeanor", "State Jail Felony"],
                answer: "Class B Misdemeanor",
                explanation: "Unauthorized refilling of a prescription for a dangerous drug is a Class B Misdemeanor, enhanced to a Class A for prior convictions.",
                reference: "Handout Page 37: HSC 483.047 - 'An offense under this section is a Class B misdemeanor...'"
            },
            {
                question: "What offense is committed if a person required to permit an inspection of dangerous drug records refuses to do so?",
                options: ["Interference with Public Duties", "Refusal to Permit Inspection", "Obstruction of Justice", "Tampering with Governmental Record"],
                answer: "Refusal to Permit Inspection",
                explanation: "HSC 483.050 creates the specific offense of 'Refusal to Permit Inspection' for failing to allow a required inspection.",
                reference: "Handout Page 37: HSC 483.050 - 'Refusal to Permit Inspection.'"
            },
            {
                question: "Under what circumstances may a pharmacist provide an emergency 72-hour refill of a dangerous drug without a doctor's authorization?",
                options: ["Any time a patient requests it.", "Only if the patient is out of state.", "If failure to refill might interrupt therapy or cause suffering, and the practitioner cannot be reached after reasonable effort.", "If the patient has a valid ID."],
                answer: "If failure to refill might interrupt therapy or cause suffering, and the practitioner cannot be reached after reasonable effort.",
                explanation: "HSC 483.047(b) allows for a limited emergency refill under specific conditions to ensure patient safety when the doctor is unavailable.",
                reference: "Handout Page 37: HSC 483.047(b) - Lists the conditions for an emergency refill."
            },
            {
                question: "What is the penalty for diverting a controlled substance for your own personal use if you have access to it through your profession (e.g., a nurse or pharmacist)?",
                options: ["Class A Misdemeanor", "State Jail Felony", "Third Degree Felony", "Second Degree Felony"],
                answer: "State Jail Felony",
                explanation: "HSC 481.1285(c) makes it a State Jail Felony for a professional to convert controlled substances they have access to for their own use.",
                reference: "Handout Page 38: HSC 481.1285(c) - 'An offense under Subsection (b)(1) is a state jail felony.'"
            },
            {
                question: "What is the penalty for diverting a controlled substance for the unlawful use of another person if you have access to it through your profession?",
                options: ["Class A Misdemeanor", "State Jail Felony", "Third Degree Felony", "Second Degree Felony"],
                answer: "Third Degree Felony",
                explanation: "HSC 481.1285(c) makes it a Third Degree Felony for a professional to divert controlled substances to another person.",
                reference: "Handout Page 38: HSC 481.1285(c) - 'An offense under Subsection (b)(2) is a felony of the third degree.'"
            }
        ];

        // --- State Variables ---
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let originalOrder = [];

        // --- Functions ---
        function startQuiz() {
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            reviewSection.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // Store original order for review, then shuffle
            originalOrder = [...quizData];
            quizData.sort(() => Math.random() - 0.5);
            
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            
            showQuestion();
            updateScoreCounter();
        }

        function showQuestion() {
            resetState();
            const currentQuestion = quizData[currentQuestionIndex];
            questionText.innerText = currentQuestion.question;
            questionCounter.innerText = `Question ${currentQuestionIndex + 1} of ${quizData.length}`;
            
            // Create and display options
            currentQuestion.options.forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.classList.add('w-full', 'text-left', 'p-4', 'border', 'rounded-lg', 'transition-colors', 'duration-200', 'hover:bg-indigo-100', 'hover:border-indigo-400');
                button.addEventListener('click', () => selectAnswer(button, option));
                optionsContainer.appendChild(button);
            });
        }

        function resetState() {
            nextBtn.disabled = true;
            nextBtn.innerText = 'Next Question';
            while (optionsContainer.firstChild) {
                optionsContainer.removeChild(optionsContainer.firstChild);
            }
        }

        function selectAnswer(button, selectedOption) {
            const currentQuestion = quizData[currentQuestionIndex];
            const correct = selectedOption === currentQuestion.answer;

            // Find the original index of the current question for storing the answer
            const originalIndex = originalOrder.findIndex(q => q.question === currentQuestion.question);
            userAnswers[originalIndex] = {
                question: currentQuestion.question,
                selected: selectedOption,
                correctAnswer: currentQuestion.answer,
                isCorrect: correct,
                explanation: currentQuestion.explanation,
                reference: currentQuestion.reference
            };

            if (correct) {
                score++;
            }
            scoreCounter.innerText = `Score: ${score} / ${currentQuestionIndex + 1}`;
            
            Array.from(optionsContainer.children).forEach(child => {
                child.disabled = true;
                if (child.innerText === currentQuestion.answer) {
                    child.classList.add('correct', 'font-bold');
                } else if (child.innerText === selectedOption) {
                    child.classList.add('incorrect', 'font-bold');
                }
            });

            const explanationEl = document.createElement('div');
            explanationEl.innerHTML = `
                <p class="font-semibold mt-4">Explanation:</p>
                <p>${currentQuestion.explanation}</p>
                <div class="mt-2 pt-2 border-t border-gray-300">
                    <p class="font-semibold">Reference:</p>
                    <p class="text-sm">${currentQuestion.reference}</p>
                </div>
            `;
            explanationEl.classList.add('explanation', 'p-4', 'rounded-lg', 'mt-4');
            optionsContainer.appendChild(explanationEl);

            nextBtn.disabled = false;
            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.innerText = 'Show Results';
            }
        }

        function handleNextButton() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            finalScore.innerText = `${score} / ${quizData.length}`;
            
            const percentage = (score / quizData.length) * 100;
            if (percentage >= 80) {
                scoreMessage.innerText = "Excellent work! You have a strong grasp of the material.";
            } else if (percentage >= 60) {
                scoreMessage.innerText = "Good job! A little more review could be beneficial.";
            } else {
                scoreMessage.innerText = "It might be a good idea to review the handout again. Keep trying!";
            }
        }
        
        function updateScoreCounter() {
             scoreCounter.innerText = `Score: ${score} / ${currentQuestionIndex}`;
        }

        function showReview() {
            reviewContainer.innerHTML = ''; 
            
            // Use the userAnswers array which is now indexed correctly
            userAnswers.forEach((answer, index) => {
                if (!answer) return; // Skip if a question was somehow not answered

                const card = document.createElement('div');
                card.classList.add('bg-white', 'p-6', 'rounded-xl', 'shadow-md');
                
                const isCorrect = answer.isCorrect;
                const resultClass = isCorrect ? 'text-green-600' : 'text-red-600';
                const resultText = isCorrect ? 'Correct' : 'Incorrect';

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">Question ${index + 1}</h3>
                        <span class="font-bold ${resultClass}">${resultText}</span>
                    </div>
                    <p class="font-medium text-gray-700 mb-4">${answer.question}</p>
                    <div class="space-y-2 text-sm">
                        <p><strong>Your Answer:</strong> <span class="${!isCorrect ? 'text-red-600' : ''}">${answer.selected}</span></p>
                        <p><strong>Correct Answer:</strong> <span class="text-green-700">${answer.correctAnswer}</span></p>
                        <div class="explanation p-3 rounded-md mt-3">
                            <p class="font-semibold">Explanation:</p>
                            <p>${answer.explanation}</p>
                            <div class="mt-2 pt-2 border-t border-gray-300">
                                <p class="font-semibold">Reference:</p>
                                <p class="text-sm">${answer.reference}</p>
                            </div>
                        </div>
                    </div>
                `;
                reviewContainer.appendChild(card);
            });
            reviewSection.classList.remove('hidden');
            reviewSection.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', startQuiz);
        nextBtn.addEventListener('click', handleNextButton);
        restartBtn.addEventListener('click', startQuiz);
        reviewBtn.addEventListener('click', showReview);

    </script>
</body>
</html>
